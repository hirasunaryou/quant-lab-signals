# 金融時系列の統計的な特徴（入門）

このモジュールでは、価格系列とリターン系列の違い、金融データに特有な分布形状、ボラティリティの時間変動、自己相関の見方、そしてモデリング時の実務上の注意点を学びます。

関連ノートブック:
- `notebooks/04_returns_distribution.ipynb`
- `notebooks/05_volatility_clustering.ipynb`
- `notebooks/06_autocorr_stationarity_basics.ipynb`

---

## 1. 価格とリターン（対数リターン）

- **価格** \(P_t\) は水準そのものです。
- **単純リターン** は \(R_t = \frac{P_t}{P_{t-1}} - 1\)。
- **対数リターン** は次式で定義します。

$$
r_t = \log\left(\frac{P_t}{P_{t-1}}\right)
$$

対数リターンは時間方向に加法的（複利の積が和に変換）で、統計処理やモデル化で扱いやすいことが多いです。

---

## 2. 正規分布からの乖離（ヘビーテール、歪度・尖度）

金融リターンはしばしば正規分布よりも裾が厚く（**heavy tails**）、また左右非対称（**skewness**）になることがあります。

- **歪度（skewness）**: 分布の左右非対称性
- **尖度（kurtosis）**: 裾の重さや尖り具合（超過尖度で評価することも多い）

実務上は、極端値（クラッシュ・急騰）が正規仮定より起きやすい点を前提にリスク評価する必要があります。

---

## 3. ボラティリティ・クラスタリング

金融市場では「値動きの大きい期間が連続する」「静かな期間が続く」という現象がよく見られます。これを**ボラティリティ・クラスタリング**と呼びます。

ローリング標準偏差（移動ボラティリティ）の代表例:

$$
\sigma_t^{(w)} = \sqrt{\frac{1}{w}\sum_{i=0}^{w-1}(r_{t-i} - \bar{r}_t)^2}
$$

ここで \(w\) は窓幅（例: 20, 60）です。

---

## 4. リターンと二乗リターンの自己相関

自己相関の定義（ラグ \(k\)）:

$$
\rho_k = \frac{\sum_{t=k+1}^{T}(x_t-\bar{x})(x_{t-k}-\bar{x})}{\sum_{t=1}^{T}(x_t-\bar{x})^2}
$$

金融データでは一般に:
- 生リターン \(r_t\) の自己相関は小さい（ゼロ近傍）
- ただし \(|r_t|\) や \(r_t^2\) には有意な自己相関が残りやすい

この差が「方向予測は難しいが、変動の大きさは持続しやすい」という実務感覚につながります。

---

## 5. 定常性の直感

- **価格系列**はトレンドやレベルシフトを含みやすく、非定常になりやすい
- **リターン系列**は平均・分散が比較的安定し、価格より定常に近いことが多い

そのため、回帰・予測モデルでは価格そのものよりリターンや差分系列を使う設計が一般的です。

---

## 6. モデリング上の実務的含意（リーケージ・スケーリング・ラベル）

1. **リーケージ防止**
   - 学習データに未来情報が混ざると精度が過大評価される
   - 時系列分割（過去→未来）を厳守する

2. **スケーリング**
   - 標準化パラメータ（平均・分散）は訓練期間だけで推定
   - 推論時はその固定値を適用

3. **ラベル設計**
   - 未来 \(h\) 期間のリターン符号、閾値超過、ボラティリティ状態など目的に応じて定義
   - ラベル作成時も未来参照区間の扱いを明確化

---

## まとめ

- 価格よりリターンを扱うと統計的に素直になる場面が多い
- リターン分布は正規分布から外れやすく、裾リスクを軽視しないことが重要
- ボラティリティは自己相関構造を持ちやすく、\(|r|\)・\(r^2\) のACFが有効
- モデル構築ではリーケージ防止・時系列整合性を最優先にする
