# ルール診断チュートリアル（EMAクロス + ATRレジームフィルタ）

対応ノートブック: `notebooks/02_rule_diagnostics.ipynb`

## 目的

EMAクロス戦略の典型的な失敗パターン（whipsaw・lag）を、
ATRベースのレジーム判定と組み合わせて定量診断する。

## 学習ポイント（要点）

- `ema_diff = EMA_fast - EMA_slow` の符号変化でクロスを定義する。
- ATRが閾値（ATRのローリング中央値）を上回るときのみ「active」と判定する。
- `BUY/SELL/HOLD` 件数、active比率、whipsaw回数を数値で比較する。
- 大きな日次変動の前後を抜き出し、EMAの遅れ（lag）を観察する。

## つまずきやすい点

1. **クロスが多い = 良い戦略** ではない
   - 横ばい相場ではクロス回数だけ増えてダマしになりやすい。
2. **ATR閾値の解釈**
   - 閾値は固定値ではなく、期間依存の相対指標（ローリング中央値）である。
3. **whipsaw定義の依存性**
   - `WHIPSAW_N` の設定で件数は大きく変わるため、比較時は同じ定義を使う。

## 次の一歩

- `EMA_FAST/EMA_SLOW`, `ATR_PERIOD`, `REGIME_WIN`, `WHIPSAW_N` を変えて
  予想 → 実行 → 検証のサイクルを回す。
- `QQQ` 以外（`SPY`, `IWM` など）へ適用して市場特性差を比較する。
